\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[margin = 0.8in]{geometry}
\usepackage{graphicx}
\usepackage{amsmath, amssymb}
\usepackage{subcaption}
\usepackage{multirow}
\usepackage{mathtools}
\usepackage{float}


\title{RBE549 - Homework 10}
\author{Keith Chester}
\date{Due date: November 23, 2022}

\begin{document}
\maketitle

\section*{Problem 1}

In this problem ,we are asked to consider two surfaces:

\begin{equation}
    z_1 = \frac{1}{2} \ln(x^2 + y^2)
\end{equation}

\noindent ...and...

\begin{equation}
    z_2 = \tan^-1(\frac{x}{y})
\end{equation}

\subsection*{A}

We are asked to find $p(x,y)$ and $q(x,y)$ for both surfaces. $p(x,y)=\frac{\partial z_n}{\partial x}$ and $q(x,y)=\frac{\partial z_n}{d_y}$. So we solve for each:

\begin{equation}
    p_1 = \frac{\partial z_1}{\partial x} = \frac{\partial}{\partial x} \frac{1}{2} \ln(x^2 + y^2) = \frac{x}{x^2+y^2}
\end{equation}

\begin{equation}
    q_1 = \frac{\partial z_1}{\partial y} = \frac{\partial}{\partial y} \frac{1}{2} \ln(x^2 + y^2) = \frac{y}{x^2+y^2}
\end{equation}

\begin{equation}
    p_2 = \frac{\partial z_2}{\partial x} = \frac{\partial}{\partial x} \tan^-1(\frac{x}{y}) = \frac{y}{x^2 + y^2}
\end{equation}

\begin{equation}
    q_2 = \frac{\partial z_2}{\partial y} = \frac{\partial}{\partial y} \tan^-1(\frac{x}{y}) =  -\frac{x}{x^2+y^2}
\end{equation}

\subsection*{B}

Here, we are tasked in showing that $z_1$ and $z_2$ gives rise to the same shading when a rotationally symmetric reflectance map applies; $R(p,q) = R(p^2 + q^2)$.

Here, we can show this by demonstrating that $p_1^2 + q_1^2 = p_2^2 + q^2$.

\begin{equation}
    p_1^2 + q_1^2 = p_2^2 + q^2
\end{equation}

\begin{equation}
    \frac{x}{x^2+y^2}^2 + \frac{y}{x^2+y^2}^2 = \frac{y}{x^2 + y^2}^2 + -\frac{x}{x^2+y^2}^2
\end{equation}

\begin{equation}
    \frac{x^2}{x^2+y^2} + \frac{y^2}{(x^2+y^2)^2} = \frac{y^2}{(x^2+y^2)^2} + \frac{x^2}{x^2+y^2}
\end{equation}

\begin{equation}
    \frac{1}{x^2+y^2} = \frac{1}{x^2+y^2}
\end{equation}

\noindent


\section{Problem 2}

In this problem, we're looking at a surface normal $\hat{n}=\begin{bmatrix}n_x & n_y & n_z\end{bmatrix}^T$, where $n_x^2 + n_y^2 + n_z^2 = 1$, and can be represented by surface orientation $p,q.p = \frac{n_x}{\sqrt{1-n_x^2-n_y^2}}$, etc. In addition to the original origin, $\begin{bmatrix}0 & 0 & 0 \end{bmatrix}^T$, we can use another origin from the point $\begin{bmatrix}0 & 0 & -1 \end{bmatrix}^T$.

\subsection*{A}

Here, we are tasked with solving for $f$ and $g$. We can do this by solving for the line of the vector from our new origin point of $\begin{bmatrix}0 & 0 & -1 \end{bmatrix}^T$.

\begin{equation}
    \begin{bmatrix}
        x \\ y \\ z
    \end{bmatrix} = \begin{bmatrix}
        a \\ b \\ c 
    \end{bmatrix} + k \begin{bmatrix}
        l \\ m \\ n
    \end{bmatrix}
\end{equation}

\noindent Note that the slopes represented by our variables can be further defined as:

\begin{equation}
    \begin{bmatrix}
        l \\ m \\ n
    \end{bmatrix} = \begin{bmatrix}
        x_2 - x_1 \\ y_2 - y_1 \\ z_2 - z_1
    \end{bmatrix}
\end{equation}

\noindent Our $x$ and our $y$ are the values we're seeking to solve for, $f$ and $g$, respectively. Now we fill in our known values to solve for our line:

\begin{equation}
    \begin{bmatrix}
        x \\ y \\ z
    \end{bmatrix} = \begin{bmatrix}
        a \\ b \\ c 
    \end{bmatrix} + k \begin{bmatrix}
        x_2 - x_1 \\ y_2 - y_1 \\ z_2 - z_1
    \end{bmatrix}
\end{equation}

\begin{equation}
    \begin{bmatrix}
        f \\ g \\ 1
    \end{bmatrix} = \begin{bmatrix}
        0 \\ 0 \\ -1 
    \end{bmatrix} + k \begin{bmatrix}
        n_x - 0 \\ n_y - 0 \\ n_z + 1
    \end{bmatrix}
\end{equation}

\noindent We can then break this down into a system of equations. First, we solve for $t$ using our $z$ value as we have an additional known here.

\begin{equation}
    1 = -1 + k (n_z + 1)
\end{equation}

\begin{equation}
    k = \frac{2}{n_z+1}
\end{equation}

\noindent ...and now we can solve for $f$ and $g$:

\begin{equation}
    f = 0 + k (n_x-0) = \frac{2n_x}{n_z+1}
\end{equation}

\begin{equation}
    g = 0 + k(n_y-0) = \frac{2n}{n_z+1}
\end{equation}

\noindent Resulting in a final $f$, $g$, $z$ = 

\begin{equation}
    \begin{bmatrix}
        f \\ g \\ 1
    \end{bmatrix} = \begin{bmatrix}
        \frac{2n_x}{n_z+1} \\ \\ \frac{2n_y}{n_z+1} \\ \\ 1
    \end{bmatrix}
\end{equation}

\subsection*{B}

Now we are taskedwith showing that when $n_z = 0$, $f$ and $g$ are finite and lie on a circle of radius $2$.

\begin{equation}
    f = \frac{2n_x}{n_z+1} = \frac{2n_x}{0+1} = 2n_x
\end{equation}

\begin{equation}
    g = \frac{2n}{n_z+1} = \frac{2n_y}{0+1} = 2n_y
\end{equation}

\noindent Given these values, we can confirm the statement that $f$ and $g$ are finite as they depend upon $n_x$ and $n_y$ respectively. Now, the radius is the result of the magnitude of the vector. This means we can do the following:

\begin{equation}
    |f,g| = \sqrt{f^2 + g^2} = \sqrt{ (2n_x)^2 + (2n_y)^2 } = \sqrt{4(\sqrt{1-n^2_y})^2 + (2n_y)^2} = \sqrt{4 - 4n_y^2 + 4n_y^2} = \sqrt{4} = 2
\end{equation}


\section*{Problem 3}

Here we try our hands at a photometric stereo shading problem. We have an error $E$ defined as:

\begin{equation}
    E = \int\int F(p, q, p_x, p_y, q_x, q_y, x, y) dxdy
\end{equation}

\noindent ...where the error functional is:

\begin{equation}
    F(p, q, p_x, p_y, q_x, q_y) = \lambda(p_x^2 + p_y^2 + q_x^2 + q_y^2) + (I(x,y) - R(p,q))^2
\end{equation}

\noindent If we use the Euler-Lagrange Equations $F_p - \frac{\partial}{\partial x} F_{p_x} - \frac{\partial}{\partial y} F_{p_y} = 0$ and $F_q - \frac{\partial}{\partial x} F_{q_x} - \frac{\partial}{\partial y} F_{q_y} = 0$, show that $p$ and $q$ according to:

\begin{equation}
    p^{new}(x,y) = p_{avg} + \frac{1}{4\lambda}(I-R)\frac{\partial R}{\partial p}
\end{equation}

\begin{equation}
    q^{new}(x,y) = q_{avg} + \frac{1}{4\lambda}(I-R)\frac{\partial R}{\partial q}
\end{equation}

\noindent ...where $p_{avg}$ and $q_{avg}$ are teh averages of the neighbors of the $p$, $q$ respectively.

To tackle this, first we will find the partial derivatives of $F$ to $p$, $p_x$, $p_y$, $q$, $q_x$, and $q_y$.

\begin{equation}
    F_{p} = \frac{\partial}{\partial p} F = \frac{\partial}{\partial p} \lambda(p_x^2 + p_y^2 + q_x^2 + q_y^2) + (I(x,y) - R(p,q))^2 = 2(I(x,y)-R(p,q))\frac{\partial R}{\partial p}
\end{equation}

\begin{equation}
    F_{q} = \frac{\partial}{\partial q} F = \frac{\partial}{\partial q} \lambda(p_x^2 + p_y^2 + q_x^2 + q_y^2) + (I(x,y) - R(p,q))^2 = 2(I(x,y)-R(p,q))\frac{\partial R}{\partial q}
\end{equation}

\begin{equation}
    F_{p_x} = \frac{\partial}{\partial p_x} F = 2\lambda p_x
\end{equation}

\begin{equation}
    F_{p_y} = \frac{\partial}{\partial p_y} F = 2\lambda p_y
\end{equation}

\begin{equation}
    F_{q_x} = \frac{\partial}{\partial q_x} F = 2\lambda q_x
\end{equation}

\begin{equation}
    F_{q_y} = \frac{\partial}{\partial q_y} F = 2\lambda q_y
\end{equation}

\noindent ...and we'll need the partial derivative of these for our Euler-Lagrange equations mentioned above as well.

\begin{equation}
    \frac{\partial}{\partial x} F{p_x} = 2 \lambda p_{xx}
\end{equation}

\begin{equation}
    \frac{\partial}{\partial x} F{p_y} = 2 \lambda p_{yy}
\end{equation}

\begin{equation}
    \frac{\partial}{\partial x} F{q_x} = 2 \lambda q_{xx}
\end{equation}

\begin{equation}
    \frac{\partial}{\partial x} F{q_y} = 2 \lambda q_{yy}
\end{equation}

\noindent We can combine these components in the Euler-Lagragne equation mentioned above to get:

\begin{equation}
    F_p - \frac{\partial}{\partial x} F_{p_x} - \frac{\partial}{\partial y} F_{p_y} = 
    2(I(x,y)-R(p,q))\frac{\partial R}{\partial p} - 2 \lambda p_{xx} - 2\lambda p_{yy} = 0
\end{equation}

\begin{equation}
    F_q - \frac{\partial}{\partial x} F_{p_x} - \frac{\partial}{\partial y} F_{p_y} = 
    2(I(x,y)-R(p,q))\frac{\partial R}{\partial q} - 2 \lambda q_{xx} - 2\lambda q_{yy} = 0
\end{equation}

\noindent If we then say that $\Delta q = q_{xx} + q_{yy}$ we can expand by claiming that $\Delta q = - \frac{1}{\lambda}(I(x,y) - R(p,q)) \frac{\partial R}{\partial q}$, our Laplacian.

From here we swap to a discrete space versus the continuous space we've been working on, focusing on pixels. If we label a given $p_{i,j}$ where $(i,j)$ are the coordinates, we can do the following:

\begin{equation}
    \Delta p_{ij} = (p_{i-1,j} + p_{i,j+1} + p_{i+1,j} + p_{i, j-1}) - 4p_{ij} = 4(\bar{p}_{i_j} - p_{ij})
\end{equation}

\noindent ...where we define $\bar{p}_{i,j}$ as an average of these points, so:

\begin{equation}
    \bar{p}_{i,j} = \frac{1}{4}(p_{i-1,j} + p_{i,j+1} + p_{i+1,j} + p_{i, j-1})
\end{equation}

\noindent meaning...

\begin{equation}
    4(\bar{p}_{i_j} - p_{ij}) = \frac{-1}{\lambda}(I(x,y)-R(p,q))\frac{\partial R}{\partial p}
\end{equation}

\begin{equation}
    p_{ij} = \bar{p}_{i,j} + \frac{-1}{4 \lambda}(I(x,y)-R(p,q))\frac{\partial R}{\partial p}
\end{equation}

\noindent And for $q$:

\begin{equation}
    4(\bar{q}_{i_j} - q_{ij}) = \frac{-1}{\lambda}(I(x,y)-R(p,q))\frac{\partial R}{\partial q}
\end{equation}

\begin{equation}
    q_{ij} = \bar{q}_{i,j} + \frac{-1}{4 \lambda}(I(x,y)-R(p,q))\frac{\partial R}{\partial q}
\end{equation}

\noindent We can apply these to an iterative (because we are working in discrete pixel space as opposed to our earlier continuous space), solving with $p_{i,j}^{k+1}$ and $p_{i,j}^{-k}$ as our iterative steps in place of $p_{i,j}$ and $\bar{p}_{i,j}$, respectively. This approach can also be instead said to be $p^{new}$ and $p_{old}$, respectively:

\begin{equation}
    p^{new} = p^{avg} + \frac{1}{\lambda}(I(x,y)-R(p,q))\frac{\partial R}{\partial p}
\end{equation}

\noindent ...and similary for $q$:

\begin{equation}
    q^{new} = q^{avg} + \frac{1}{\lambda}(I(x,y)-R(p,q))\frac{\partial R}{\partial q}
\end{equation}


\end{document}